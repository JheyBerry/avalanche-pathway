"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const buffer_1 = require("buffer/");
const bintools_1 = __importDefault(require("src/utils/bintools"));
const credentials_1 = require("src/common/credentials");
const output_1 = require("src/common/output");
const helperfunctions_1 = require("src/utils/helperfunctions");
const bintools = bintools_1.default.getInstance();
describe('UnixNow', () => {
    test('Does it return the right time?', () => {
        const now = Math.round((new Date()).getTime() / 1000);
        const unow = helperfunctions_1.UnixNow();
        expect(now / 10).toBeCloseTo(unow.divn(10).toNumber(), -1);
    });
});
describe('Signature & NBytes', () => {
    const sig = new credentials_1.Signature();
    const sigpop = [];
    for (let i = 0; i < sig.getSize(); i++) {
        sigpop[i] = i;
    }
    const sigbuff = buffer_1.Buffer.from(sigpop);
    const size = sig.fromBuffer(sigbuff);
    expect(sig.getSize()).toBe(size);
    expect(size).toBe(sig.getSize());
    const sigbuff2 = sig.toBuffer();
    for (let i = 0; i < sigbuff.length; i++) {
        expect(sigbuff2[i]).toBe(sigbuff[i]);
    }
    const sigbuffstr = bintools.bufferToB58(sigbuff);
    expect(sig.toString()).toBe(sigbuffstr);
    sig.fromString(sigbuffstr);
    expect(sig.toString()).toBe(sigbuffstr);
});
describe('SigIdx', () => {
    const sigidx = new credentials_1.SigIdx();
    expect(sigidx.getSize()).toBe(sigidx.toBuffer().length);
    sigidx.setSource(buffer_1.Buffer.from('abcd', 'hex'));
    expect(sigidx.getSource().toString('hex')).toBe('abcd');
});
describe('Address', () => {
    const addr1 = new output_1.Address();
    const addr2 = new output_1.Address();
    const smaller = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0];
    const bigger = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9, 8, 7, 6, 5, 4, 3, 2, 1, 1];
    const addr1bytes = buffer_1.Buffer.from(smaller);
    const addr2bytes = buffer_1.Buffer.from(bigger);
    addr1.fromBuffer(addr1bytes);
    addr2.fromBuffer(addr2bytes);
    expect(output_1.Address.comparator()(addr1, addr2)).toBe(-1);
    expect(output_1.Address.comparator()(addr2, addr1)).toBe(1);
    const addr2str = addr2.toString();
    addr2.fromBuffer(addr1bytes);
    expect(output_1.Address.comparator()(addr1, addr2)).toBe(0);
    addr2.fromString(addr2str);
    expect(output_1.Address.comparator()(addr1, addr2)).toBe(-1);
    const a1b = addr1.toBuffer();
    const a1s = bintools.bufferToB58(a1b);
    addr2.fromString(a1s);
    expect(output_1.Address.comparator()(addr1, addr2)).toBe(0);
    const badbuff = bintools.copyFrom(addr1bytes);
    let badbuffout = buffer_1.Buffer.concat([badbuff, buffer_1.Buffer.from([1, 2])]);
    let badstr = bintools.bufferToB58(badbuffout);
    const badaddr = new output_1.Address();
    expect(() => {
        badaddr.fromString(badstr);
    }).toThrow('Error - Address.fromString: invalid address');
    badbuffout = buffer_1.Buffer.concat([badbuff, buffer_1.Buffer.from([1, 2, 3, 4])]);
    badstr = bintools.bufferToB58(badbuffout);
    expect(() => {
        badaddr.fromString(badstr);
    }).toThrow('Error - Address.fromString: invalid checksum on address');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZXMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3RzL2FwaXMvYXZtL3R5cGVzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxvQ0FBaUM7QUFDakMsa0VBQTBDO0FBQzFDLHdEQUEyRDtBQUMzRCw4Q0FBNEM7QUFDNUMsK0RBQW9EO0FBSXBELE1BQU0sUUFBUSxHQUFZLGtCQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7QUFFakQsUUFBUSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7SUFDdkIsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLEdBQUcsRUFBRTtRQUMxQyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQ3RELE1BQU0sSUFBSSxHQUFHLHlCQUFPLEVBQUUsQ0FBQztRQUN2QixNQUFNLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDN0QsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbEMsTUFBTSxHQUFHLEdBQUcsSUFBSSx1QkFBUyxFQUFFLENBQUM7SUFDNUIsTUFBTSxNQUFNLEdBQWlCLEVBQUUsQ0FBQztJQUNoQyxLQUFLLElBQUksQ0FBQyxHQUFVLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQzdDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDZjtJQUNELE1BQU0sT0FBTyxHQUFVLGVBQU0sQ0FBQyxJQUFJLENB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Q0FBQyxPQUFPLEVBQUUsZUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0RSxJQUFJLE1BQU0sR0FBVSxRQUFRLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3JELE1BQU0sT0FBTyxHQUFXLElBQUksZ0JBQU8sRUFBRSxDQUFDO0lBRXRDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDVixPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO0lBRTFELFVBQVUsR0FBRyxlQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxFQUFFLGVBQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqRSxNQUFNLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUMxQyxNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ1YsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM3QixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMseURBQXlELENBQUMsQ0FBQztBQUN4RSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ1ZmZlciB9IGZyb20gJ2J1ZmZlci8nO1xuaW1wb3J0IEJpblRvb2xzIGZyb20gJ3NyYy91dGlscy9iaW50b29scyc7XG5pbXBvcnQgeyBTaWdJZHgsIFNpZ25hdHVyZSB9IGZyb20gJ3NyYy9jb21tb24vY3JlZGVudGlhbHMnO1xuaW1wb3J0IHsgQWRkcmVzcyB9IGZyb20gJ3NyYy9jb21tb24vb3V0cHV0JztcbmltcG9ydCB7IFVuaXhOb3cgfSBmcm9tICdzcmMvdXRpbHMvaGVscGVyZnVuY3Rpb25zJztcblxuXG5cbmNvbnN0IGJpbnRvb2xzOkJpblRvb2xzID0gQmluVG9vbHMuZ2V0SW5zdGFuY2UoKTtcblxuZGVzY3JpYmUoJ1VuaXhOb3cnLCAoKSA9PiB7XG4gIHRlc3QoJ0RvZXMgaXQgcmV0dXJuIHRoZSByaWdodCB0aW1lPycsICgpID0+IHtcbiAgICBjb25zdCBub3cgPSBNYXRoLnJvdW5kKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgLyAxMDAwKTtcbiAgICBjb25zdCB1bm93ID0gVW5peE5vdygpO1xuICAgIGV4cGVjdChub3cgLyAxMCkudG9CZUNsb3NlVG8odW5vdy5kaXZuKDEwKS50b051bWJlcigpLCAtMSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdTaWduYXR1cmUgJiBOQnl0ZXMnLCAoKSA9PiB7XG4gIGNvbnN0IHNpZyA9IG5ldyBTaWduYXR1cmUoKTtcbiAgY29uc3Qgc2lncG9wOkFycmF5PG51bWJlcj4gPSBbXTtcbiAgZm9yIChsZXQgaTpudW1iZXIgPSAwOyBpIDwgc2lnLmdldFNpemUoKTsgaSsrKSB7XG4gICAgc2lncG9wW2ldID0gaTtcbiAgfVxuICBjb25zdCBzaWdidWZmOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKHNpZ3BvcCk7XG4gIGNvbnN0IHNpemUgPSBzaWcuZnJvbUJ1ZmZlcihzaWdidWZmKTtcbiAgZXhwZWN0KHNpZy5nZXRTaXplKCkpLnRvQmUoc2l6ZSk7XG4gIGV4cGVjdChzaXplKS50b0JlKHNpZy5nZXRTaXplKCkpO1xuICBjb25zdCBzaWdidWZmMjpCdWZmZXIgPSBzaWcudG9CdWZmZXIoKTtcbiAgZm9yIChsZXQgaTpudW1iZXIgPSAwOyBpIDwgc2lnYnVmZi5sZW5ndGg7IGkrKykge1xuICAgIGV4cGVjdChzaWdidWZmMltpXSkudG9CZShzaWdidWZmW2ldKTtcbiAgfVxuICBjb25zdCBzaWdidWZmc3RyOnN0cmluZyA9IGJpbnRvb2xzLmJ1ZmZlclRvQjU4KHNpZ2J1ZmYpO1xuICBleHBlY3Qoc2lnLnRvU3RyaW5nKCkpLnRvQmUoc2lnYnVmZnN0cik7XG4gIHNpZy5mcm9tU3RyaW5nKHNpZ2J1ZmZzdHIpO1xuICBleHBlY3Qoc2lnLnRvU3RyaW5nKCkpLnRvQmUoc2lnYnVmZnN0cik7XG59KTtcblxuZGVzY3JpYmUoJ1NpZ0lkeCcsICgpID0+IHtcbiAgY29uc3Qgc2lnaWR4OlNpZ0lkeCA9IG5ldyBTaWdJZHgoKTtcbiAgZXhwZWN0KHNpZ2lkeC5nZXRTaXplKCkpLnRvQmUoc2lnaWR4LnRvQnVmZmVyKCkubGVuZ3RoKTtcbiAgc2lnaWR4LnNldFNvdXJjZShCdWZmZXIuZnJvbSgnYWJjZCcsICdoZXgnKSk7XG4gIGV4cGVjdChzaWdpZHguZ2V0U291cmNlKCkudG9TdHJpbmcoJ2hleCcpKS50b0JlKCdhYmNkJyk7XG59KTtcblxuZGVzY3JpYmUoJ0FkZHJlc3MnLCAoKSA9PiB7XG4gIGNvbnN0IGFkZHIxID0gbmV3IEFkZHJlc3MoKTtcbiAgY29uc3QgYWRkcjIgPSBuZXcgQWRkcmVzcygpO1xuICBjb25zdCBzbWFsbGVyOkFycmF5PG51bWJlcj4gPSBbMCwgMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgOSwgOCwgNywgNiwgNSwgNCwgMywgMiwgMSwgMF07XG4gIGNvbnN0IGJpZ2dlcjpBcnJheTxudW1iZXI+ID0gWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDksIDgsIDcsIDYsIDUsIDQsIDMsIDIsIDEsIDFdO1xuICBjb25zdCBhZGRyMWJ5dGVzOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKHNtYWxsZXIpO1xuICBjb25zdCBhZGRyMmJ5dGVzOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJpZ2dlcik7XG4gIGFkZHIxLmZyb21CdWZmZXIoYWRkcjFieXRlcyk7XG4gIGFkZHIyLmZyb21CdWZmZXIoYWRkcjJieXRlcyk7XG4gIGV4cGVjdChBZGRyZXNzLmNvbXBhcmF0b3IoKShhZGRyMSwgYWRkcjIpKS50b0JlKC0xKTtcbiAgZXhwZWN0KEFkZHJlc3MuY29tcGFyYXRvcigpKGFkZHIyLCBhZGRyMSkpLnRvQmUoMSk7XG5cbiAgY29uc3QgYWRkcjJzdHI6c3RyaW5nID0gYWRkcjIudG9TdHJpbmcoKTtcblxuICBhZGRyMi5mcm9tQnVmZmVyKGFkZHIxYnl0ZXMpO1xuICBleHBlY3QoQWRkcmVzcy5jb21wYXJhdG9yKCkoYWRkcjEsIGFkZHIyKSkudG9CZSgwKTtcblxuICBhZGRyMi5mcm9tU3RyaW5nKGFkZHIyc3RyKTtcbiAgZXhwZWN0KEFkZHJlc3MuY29tcGFyYXRvcigpKGFkZHIxLCBhZGRyMikpLnRvQmUoLTEpO1xuICBjb25zdCBhMWI6QnVmZmVyID0gYWRkcjEudG9CdWZmZXIoKTtcbiAgY29uc3QgYTFzOnN0cmluZyA9IGJpbnRvb2xzLmJ1ZmZlclRvQjU4KGExYik7XG4gIGFkZHIyLmZyb21TdHJpbmcoYTFzKTtcbiAgZXhwZWN0KEFkZHJlc3MuY29tcGFyYXRvcigpKGFkZHIxLCBhZGRyMikpLnRvQmUoMCk7XG5cbiAgY29uc3QgYmFkYnVmZjpCdWZmZXIgPSBiaW50b29scy5jb3B5RnJvbShhZGRyMWJ5dGVzKTtcbiAgbGV0IGJhZGJ1ZmZvdXQ6QnVmZmVyID0gQnVmZmVyLmNvbmNhdChbYmFkYnVmZiwgQnVmZmVyLmZyb20oWzEsIDJdKV0pO1xuICBsZXQgYmFkc3RyOnN0cmluZyA9IGJpbnRvb2xzLmJ1ZmZlclRvQjU4KGJhZGJ1ZmZvdXQpO1xuICBjb25zdCBiYWRhZGRyOkFkZHJlc3MgPSBuZXcgQWRkcmVzcygpO1xuXG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgYmFkYWRkci5mcm9tU3RyaW5nKGJhZHN0cik7XG4gIH0pLnRvVGhyb3coJ0Vycm9yIC0gQWRkcmVzcy5mcm9tU3RyaW5nOiBpbnZhbGlkIGFkZHJlc3MnKTtcblxuICBiYWRidWZmb3V0ID0gQnVmZmVyLmNvbmNhdChbYmFkYnVmZiwgQnVmZmVyLmZyb20oWzEsIDIsIDMsIDRdKV0pO1xuICBiYWRzdHIgPSBiaW50b29scy5idWZmZXJUb0I1OChiYWRidWZmb3V0KTtcbiAgZXhwZWN0KCgpID0+IHtcbiAgICBiYWRhZGRyLmZyb21TdHJpbmcoYmFkc3RyKTtcbiAgfSkudG9UaHJvdygnRXJyb3IgLSBBZGRyZXNzLmZyb21TdHJpbmc6IGludmFsaWQgY2hlY2tzdW0gb24gYWRkcmVzcycpO1xufSk7XG4iXX0=